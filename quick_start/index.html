
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Seung-seob Lee">
      
      
      <link rel="icon" href="../theme/assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Quick Start - MIND</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700%7CInconsolata&display=fallback">
        <style>:root{--md-text-font-family:"Lato";--md-code-font-family:"Inconsolata"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#quick-start" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MIND" class="md-header__button md-logo" aria-label="MIND" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MIND
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Quick Start
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"/></svg>
            </label>
          
        
      </form>
    
    
    
    
      <div class="md-header__source">
        
<a href="https://github.com/shsym/mind/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    shsym/mind
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MIND" class="md-nav__button md-logo" aria-label="MIND" data-md-component="logo">
      
  <img src="../img/logo.png" alt="logo">

    </a>
    MIND
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/shsym/mind/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    shsym/mind
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../research/" class="md-nav__link">
        Research Papers
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          People
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="People" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          People
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../contact/" class="md-nav__link">
        MIND Team
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#download-and-install" class="md-nav__link">
    Download and Install
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-confluo" class="md-nav__link">
    Using Confluo
  </a>
  
    <nav class="md-nav" aria-label="Using Confluo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#embedded-mode" class="md-nav__link">
    Embedded Mode
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stand-alone-mode" class="md-nav__link">
    Stand-alone Mode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/shsym/mind/edit/master/docs/quick_start.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="quick-start">Quick Start<a class="headerlink" href="#quick-start" title="Permanent link">&para;</a></h1>
<p>In this Quick Start, we will take a look at how to download and setup Confluo,
load some sample data, and query it.</p>
<h2 id="pre-requisites">Pre-requisites<a class="headerlink" href="#pre-requisites" title="Permanent link">&para;</a></h2>
<ul>
<li>MacOS X or Unix-based OS; Windows is not yet supported.</li>
<li>C++ compiler that supports C++11 standard (e.g., GCC 5.3 or later)</li>
<li>CMake 3.2 or later</li>
<li>Boost 1.58 or later</li>
</ul>
<p>For python client, you will additionally require:</p>
<ul>
<li>Python 2.7 or later</li>
<li>Python Packages: setuptools, six 1.7.2 or later</li>
</ul>
<p>For java client, you will additionally require:</p>
<ul>
<li>Java JDK 1.7 or later</li>
<li>ant 1.6.2 or later</li>
</ul>
<h2 id="download-and-install">Download and Install<a class="headerlink" href="#download-and-install" title="Permanent link">&para;</a></h2>
<p>To download and install Confluo, use the following commands:</p>
<div class="highlight"><pre><span></span><code>git clone https://github.com/ucbrise/confluo.git
<span class="nb">cd</span> confluo
mkdir build
<span class="nb">cd</span> build
cmake ..
make -j <span class="o">&amp;&amp;</span> make <span class="nb">test</span> <span class="o">&amp;&amp;</span> make install
</code></pre></div>
<h2 id="using-confluo">Using Confluo<a class="headerlink" href="#using-confluo" title="Permanent link">&para;</a></h2>
<p>Confluo can be used in two modes -- embedded and stand-alone. In the embedded mode,
Confluo is used as a header-only library in C++, allowing Confluo to use the same
address-space as the application process. In the stand-alone mode, Confluo runs
as a daemon server process, allowing clients to communicate with it using 
<a href="https://thrift.apache.org">Apache Thrift</a> protocol.</p>
<h3 id="embedded-mode">Embedded Mode<a class="headerlink" href="#embedded-mode" title="Permanent link">&para;</a></h3>
<p>In order to use Confluo in the embedded mode, we simply need to include
Confluo's header files under libconfluo/confluo, use the Confluo C++ API in 
a C++ application, and compile using a modern C++ compiler. The entry point 
header file to include is <code>confluo_store.h</code>. </p>
<p>We will first create a new Confluo Store with the data path for it to use 
as follows:</p>
<div class="highlight"><pre><span></span><code><span class="n">confluo</span><span class="o">::</span><span class="n">confluo_store</span><span class="w"> </span><span class="nf">store</span><span class="p">(</span><span class="s">&quot;/path/to/data&quot;</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>We then create a new Atomic MultiLog within the Store (synonymous to a database
table); this requires three parameters: name, schema, and the storage mode:</p>
<div class="highlight"><pre><span></span><code><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;{</span>
<span class="w">  </span><span class="nl">timestamp</span><span class="p">:</span><span class="w"> </span><span class="n">LONG</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nl">op_latency_ms</span><span class="p">:</span><span class="w"> </span><span class="n">DOUBLE</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nl">cpu_util</span><span class="p">:</span><span class="w"> </span><span class="n">DOUBLE</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nl">mem_avail</span><span class="p">:</span><span class="w"> </span><span class="n">DOUBLE</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nl">log_msg</span><span class="p">:</span><span class="w"> </span><span class="n">STRING</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"></span>
<span class="p">}</span><span class="s">&quot;;</span>
<span class="k">auto</span><span class="w"> </span><span class="n">storage_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">confluo</span><span class="o">::</span><span class="n">storage</span><span class="o">::</span><span class="n">IN_MEMORY</span><span class="p">;</span><span class="w"></span>
<span class="n">store</span><span class="p">.</span><span class="n">create_atomic_multilog</span><span class="p">(</span><span class="s">&quot;perf_log&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">schema</span><span class="p">,</span><span class="w"> </span><span class="n">storage_mode</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>Our schema contains 5 attributes: a signed 8-byte integer timestamp,
double floating-point precision operation latency (in ms), CPU utilization
and available memory, and a string log message field (upper bounded to 100 
characters). </p>
<p>We then obtain a reference to our newly created Atomic MultiLog:</p>
<div class="highlight"><pre><span></span><code><span class="n">confluo</span><span class="o">::</span><span class="n">atomic_multilog</span><span class="o">*</span><span class="w"> </span><span class="n">mlog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">store</span><span class="p">.</span><span class="n">get_atomic_multilog</span><span class="p">(</span><span class="s">&quot;perf_log&quot;</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>We can define indexes on the Atomic MultiLog as follows:</p>
<div class="highlight"><pre><span></span><code><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">add_index</span><span class="p">(</span><span class="s">&quot;op_latency_ms&quot;</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>to add an index on <code>op_latency_ms</code> attribute. We can also install filters as follows:</p>
<div class="highlight"><pre><span></span><code><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">add_filter</span><span class="p">(</span><span class="s">&quot;low_resources&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cpu_util&gt;0.8 || mem_avail&lt;0.1&quot;</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>to explicitly filter out records that indicate low system resources (CPU 
utilization &gt; 80%, Available Memory &lt; 10%), using a filter named <code>low_resources</code>.</p>
<p>Additionally, we can add aggregates on filters as follows:</p>
<div class="highlight"><pre><span></span><code><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">add_aggregate</span><span class="p">(</span><span class="s">&quot;max_latency_ms&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;low_resources&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MAX(op_latency_ms)&quot;</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>This adds a new stored aggregate <code>max_latency_ms</code> on the filter 
<code>low_resources</code> we defined before. In essence, it records the highest 
operation latency reported in any record that also indicated low 
available resources.</p>
<p>Finally, we can install a trigger on aggregates as follows:</p>
<div class="highlight"><pre><span></span><code><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">install_trigger</span><span class="p">(</span><span class="s">&quot;high_latency_trigger&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;max_latency &gt; 1000&quot;</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>This installs a trigger <code>high_latency_trigger</code> on the aggregate 
<code>max_latency_ms</code>, which should generate an alert whenever the 
condition <code>max_latency_ms &gt; 1000</code> is satisfied, i.e.,
whenever the maximum latency for an operation exceeds 1s and
the available resources are low.</p>
<p>We are now ready to load some data into this multilog:</p>
<div class="highlight"><pre><span></span><code><span class="kt">size_t</span><span class="w"> </span><span class="n">off1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">append</span><span class="p">({</span><span class="s">&quot;100&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0.5&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0.9&quot;</span><span class="p">,</span><span class="w">  </span><span class="s">&quot;INFO: Launched 1 tasks&quot;</span><span class="p">});</span><span class="w"></span>
<span class="kt">size_t</span><span class="w"> </span><span class="n">off2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">append</span><span class="p">({</span><span class="s">&quot;500&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0.9&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0.05&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WARN: Server {2} down&quot;</span><span class="p">});</span><span class="w"></span>
<span class="kt">size_t</span><span class="w"> </span><span class="n">off3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">append</span><span class="p">({</span><span class="s">&quot;1001&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0.9&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;0.03&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;WARN: Server {2, 4, 5} down&quot;</span><span class="p">});</span><span class="w"></span>
</code></pre></div>
<p>Note that the <code>append</code> method takes a vector of strings as its input, where
the vector corresponds to a single record. The number of entries in the
vector must match the number of entries in the schema, with the exception
of the timestamp --- if the timestamp is not provided, Confluo will automatically
assign one.</p>
<p>Also note that the operation returns a unique offset corresponding to each append
operation. This forms the "key" for records stored in the Atomic MultiLog -- records
can be retrieved by specifying their corresponding offsets.</p>
<p>Now we take a look at how we can query the data in the Atomic MultiLog. First,
it is straightforward to retrieve records given their offsets:</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">record1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">read</span><span class="p">(</span><span class="n">off1</span><span class="p">);</span><span class="w"></span>
<span class="k">auto</span><span class="w"> </span><span class="n">record2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">read</span><span class="p">(</span><span class="n">off2</span><span class="p">);</span><span class="w"></span>
<span class="k">auto</span><span class="w"> </span><span class="n">record3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">read</span><span class="p">(</span><span class="n">off3</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>Each of <code>record1</code>, <code>record2</code>, and <code>record3</code> are vectors of strings.</p>
<p>We can query indexed attributes as follows:</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">record_stream1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">execute_filter</span><span class="p">(</span><span class="s">&quot;cpu_util&gt;0.5 || mem_avail&lt;0.5&quot;</span><span class="p">);</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">record_stream1</span><span class="p">;</span><span class="w"> </span><span class="o">!</span><span class="n">s</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">tail</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">head</span><span class="p">().</span><span class="n">to_string</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Note that the operation returns a lazily evaluated stream, which supports
functional style operations like map, filter, etc. See 
<a href="https://github.com/ucbrise/confluo/blob/single-machine/libconfluo/confluo/container/lazy/stream.h">stream.h</a>
for more details.</p>
<p>We can also query the defined filter as follows:</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">record_stream2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">query_filter</span><span class="p">(</span><span class="s">&quot;low_resources&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">UINT64_MAX</span><span class="p">);</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">record_stream2</span><span class="p">;</span><span class="w"> </span><span class="o">!</span><span class="n">s</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">tail</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">head</span><span class="p">().</span><span class="n">to_string</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The first parameter corresponds to the name of the filter to be queried, while 
the second and third parameters correspond to the begining timestamp and end 
timestamp to consider for records in the filter. We've specified them to capture
all possible values of timestamp. Similar to the <code>execute_filter</code> query, this
operation also returns a lazily evaluated record stream.</p>
<p>We query aggregates as follows:
<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">get_aggregate</span><span class="p">(</span><span class="s">&quot;max_latency_ms&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">UINT64_MAX</span><span class="p">);</span><span class="w"></span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">to_string</span><span class="p">();</span><span class="w"></span>
</code></pre></div></p>
<p>The query takes the name of the aggregate as its first parameter, while the 
second and third parameters correspond to begin and end timestmaps, as before.
The query returns a <a href="https://github.com/ucbrise/confluo/blob/single-machine/libconfluo/confluo/types/numeric.h"><code>numeric</code></a> 
object, which is a wrapper around numeric values.</p>
<p>Finally, we can query the generated alerts by triggers we have installed as
follows:</p>
<div class="highlight"><pre><span></span><code><span class="k">auto</span><span class="w"> </span><span class="n">alert_stream</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mlog</span><span class="o">-&gt;</span><span class="n">get_alerts</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">UINT64_MAX</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;high_latency_trigger&quot;</span><span class="p">);</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">alert_stream</span><span class="p">;</span><span class="w"> </span><span class="o">!</span><span class="n">s</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">tail</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">head</span><span class="p">().</span><span class="n">to_string</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The query takes and begin and end timestamps as its first and second arguments,
and an optional trigger name as its third argument. The query returns a lazy 
stream over generated alerts for this trigger in the specified time-range.</p>
<p>See API docs for <a href="../cpp_api/">C++</a> and in-depth user guides on <a href="../loading_data/">Data Storage</a>
and <a href="../queries/">Conflo Queries</a> for details on Confluo's supported operations.</p>
<h3 id="stand-alone-mode">Stand-alone Mode<a class="headerlink" href="#stand-alone-mode" title="Permanent link">&para;</a></h3>
<p>In the stand-alone mode, Confluo runs as a daemon server, serving client requests
using Apache Thrift protocol. To start the server, run:</p>
<div class="highlight"><pre><span></span><code>confluod --address<span class="o">=</span><span class="m">127</span>.0.0.1 --port<span class="o">=</span><span class="m">9090</span>
</code></pre></div>
<p>Once the server daemon is running, you can query it using the C++, Python or Java 
client APIs. The client APIs closely resemble the embedded API.</p>
<p>We first create a new client connection to the Confluo daemon:</p>
<p>```cpp tab="C++"
confluo::rpc::rpc_client client("127.0.0.1", 9090);
<div class="highlight"><pre><span></span><code>```python tab=&quot;Python&quot;
from confluo.rpc.client import RpcClient

client = RpcClient(&quot;127.0.0.1&quot;, 9090)
</code></pre></div></p>
<p>The first argument to the <code>rpc_client</code> constructor corresponds to the server
hostname, while the second argument corresponds to the server port.</p>
<p>We then create a new Atomic MultiLog within the Store (synonymous to a database
table); as before, this requires three parameters: a name for the Atomic 
MultiLog, a fixed schema, and a storage mode:</p>
<p>```cpp tab="C++"
std::string schema = "{
  timestamp: ULONG,
  op_latency_ms: DOUBLE,
  cpu_util: DOUBLE,
  mem_avail: DOUBLE,
  log_msg: STRING(100)
}";
auto storage_mode = confluo::storage::IN_MEMORY;
client.create_atomic_multilog("perf_log", schema, storage_mode);
<div class="highlight"><pre><span></span><code>```python tab=&quot;Python&quot;
from confluo.rpc.storage import StorageMode

schema = &quot;&quot;&quot;{
  timestamp: ULONG,
  op_latency_ms: DOUBLE,
  cpu_util: DOUBLE,
  mem_avail: DOUBLE,
  log_msg: STRING(100)
}&quot;&quot;&quot;
storage_mode = StorageMode.IN_MEMORY
client.create_atomic_multilog(&quot;perf_log&quot;, schema, storage_mode)
</code></pre></div></p>
<p>This operation also internally sets the current Atomic MultiLog 
for the client to the one we just created (i.e., <code>perf_log</code>).</p>
<p>We can define indexes as follows:</p>
<p>```cpp tab="C++"
client.add_index("op_latency_ms");
<div class="highlight"><pre><span></span><code>```python tab=&quot;Python&quot;
client.add_index(&quot;op_latency_ms&quot;)
</code></pre></div></p>
<p>We can also install filters as follows:</p>
<p>```cpp tab="C++"
client.add_filter("low_resources", "cpu_util&gt;0.8 || mem_avail&lt;0.1");
<div class="highlight"><pre><span></span><code>```python tab=&quot;Python&quot;
client.add_filter(&quot;low_resources&quot;, &quot;cpu_util&gt;0.8 || mem_avail&lt;0.1&quot;)
</code></pre></div></p>
<p>Additionally, we can add aggregates on filters as follows:</p>
<p>```cpp tab="C++"
client.add_aggregate("max_latency_ms", "low_resources", "MAX(op_latency_ms)");
<div class="highlight"><pre><span></span><code>```python tab=&quot;Python&quot;
client.add_aggregate(&quot;max_latency_ms&quot;, &quot;low_resources&quot;, &quot;MAX(op_latency_ms)&quot;)
</code></pre></div></p>
<p>Finally, we can install a trigger on an aggregate as follows:</p>
<p>```cpp tab="C++"
client.install_trigger("high_latency_trigger", "max_latency_ms &gt; 1000");
<div class="highlight"><pre><span></span><code>```python tab=&quot;Python&quot;
client.install_trigger(&quot;high_latency_trigger&quot;, &quot;max_latency_ms &gt; 1000&quot;)
</code></pre></div></p>
<p>To load data into the Atomic MultiLog:</p>
<p>```cpp tab="C++"
size_t off1 = client.append({"100", "0.5", "0.9",  "INFO: Launched 1 tasks"});
size_t off2 = client.append({"500", "0.9", "0.05", "WARN: Server {2} down"});
size_t off3 = client.append({"1001", "0.9", "0.03", "WARN: Server {2, 4, 5} down"});
<div class="highlight"><pre><span></span><code>```python tab=&quot;Python&quot;
off1 = client.append([100.0, 0.5, 0.9,  &quot;INFO: Launched 1 tasks&quot;])
off2 = client.append([500.0, 0.9, 0.05, &quot;WARN: Server {2} down&quot;])
off3 = client.append([1001.0, 0.9, 0.03, &quot;WARN: Server {2, 4, 5} down&quot;])
</code></pre></div></p>
<p>Querying data in the Atomic MultiLog is also similar to the Embedded mode API.</p>
<p>It is straightforward to retrieve records given their offsets:</p>
<p>```cpp tab="C++"
auto record1 = client.read(off1);
auto record2 = client.read(off2);
auto record3 = client.read(off3);
<div class="highlight"><pre><span></span><code>```python tab=&quot;Python&quot;
record1 = client.read(off1)
record2 = client.read(off2)
record3 = client.read(off3)
</code></pre></div></p>
<p>We can query indexed attributes as follows:</p>
<p>```cpp tab="C++"
auto record_stream = client.execute_filter("cpu_util&gt;0.5 || mem_avail&lt;0.5");
for (auto s = record_stream; !s.empty(); ++s) {
  std::cout &lt;&lt; s.get().to_string();
}
<div class="highlight"><pre><span></span><code>```python tab=&quot;Python&quot;
record_stream = client.execute_filter(&quot;cpu_util&gt;0.5 || mem_avail&lt;0.5&quot;)
for r in record_stream:
  print r
</code></pre></div></p>
<p>We can query a pre-defined filter as follows:</p>
<p>```cpp tab="C++"
auto record_stream = client.query_filter("low_resources", 0, UINT64_MAX);
for (auto s = record_stream; !s.empty(); ++s) {
  std::cout &lt;&lt; s.get().to_string();
}
<div class="highlight"><pre><span></span><code>```python tab=&quot;Python&quot;
import sys
record_stream = client.query_filter(&quot;low_resources&quot;, 0, sys.maxsize)
for r in record_stream:
  print r
</code></pre></div></p>
<p>We can obtian the value of a pre-defined aggregate as follows:</p>
<p>```cpp tab="C++"
std::string value = client.get_aggregate("max_latency_ms", 0, UINT64_MAX);
std::cout &lt;&lt; value;
<div class="highlight"><pre><span></span><code>```python tab=&quot;Python&quot;
import sys
value = client.get_aggregate(&quot;max_latency_ms&quot;, 0, sys.maxsize)
print value
</code></pre></div></p>
<p>Finally, we can obtain alerts generated by triggers installed on an Atomic 
MultiLog as follows:</p>
<p>```cpp tab="C++"
auto alert_stream = client.get_alerts(0, UINT64_MAX, "high_latency_trigger");
for (auto s = alert_stream; !s.empty(); ++s) {
  std::cout &lt;&lt; s.get();
}
<div class="highlight"><pre><span></span><code>```python tab=&quot;Python&quot;
import sys
alert_stream = client.get_alerts(0, sys.maxsize, &quot;high_latency_trigger&quot;)
for a in alert_stream:
  print a
</code></pre></div></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>