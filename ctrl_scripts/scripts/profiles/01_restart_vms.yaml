# Profile for tasks/commands in order
# - name: start VMs
#   job: setup
#   per_command_delay: 0
#   post_delay: 60

# ====================================================
# Before run this, the ssh key should be copied first,
# .ssh/config should have proper entry for tscript.github.com, e.g.:
# Host tscript.github.com
# HostName github.com
# User git
# IdentityFile ~/.ssh/id_script_deploy
# IdentitiesOnly yes
# ====================================================

# run_on_all_vms(mind_config, job="first_access", verbose=True,
#                per_command_delay=10, post_delay=0)

# - name: register ssh keys
#   job: first_access
#   per_command_delay: 1
#   post_delay: 10

- name: clone this repo
  job: git_clone
  job_args:
    git url: git@tscript.github.com:shsym/mind.git
  per_command_delay: 1
  post_delay: 10

- name: update repo
  job: update
  per_command_delay: 1
  post_delay: 60

- name: (re)build kernel
  job: update_kernel
  per_command_delay: 0
  post_delay: 60

- name: restart and reset VMs
  job: reset
  per_command_delay: 0
  post_delay: 60

# IF we need to shutdown VMs
# - name: shutdown VMs
#   job: shutdown   # this will only shutdown VMs
#   per_command_delay: 0
#   post_delay: 10